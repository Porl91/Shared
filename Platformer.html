<!doctype html/>
<html>
	<head>
		<title>Platformer</title>
	</head>
	<body>
		<canvas id="scene"></canvas>
		<link rel="stylesheet" type="text/css" href="Content/CSS/Global.css"/>
		<script src="Geom/Vector2.js" type="text/javascript"></script>
		<script src="Geom/BoundingUnits/AABB.js" type="text/javascript"></script>
		<script src="Geom/LineSegment.js" type="text/javascript"></script>
		<script src="ViewModels/GameViewModel.js" type="text/javascript"></script>
		
		<script>
			var lineSegs = [];
		
			var Initialise = function(viewModel) {
				var xStart = 150;
				var yStart = 400;
				var currentPoint = new Vector2(xStart, yStart);
				
				// Generate 10 connected lines for the platform
				for(var i = 1; i < 10; i++) {
					var nextPoint = new Vector2(i * 80 + xStart, currentPoint.y + ((Math.random() - 0.5) * 100) | 0);
					lineSegs.push(new LineSegment(currentPoint, nextPoint));
					currentPoint = nextPoint;
				}
				
				/*
				var l1 = new LineSegment(new Vector2(100, 20), new Vector2(200, 100));
				var l2 = new LineSegment(new Vector2(150, 20), new Vector2(200, 150));
				
				window.onkeydown = function(e) {
					l1.Point2.x += function(e) {
						switch(e.keyCode) {
							case 65: 
								return -1;
							case 68:
								return 1;
						}
						return 0;
					}(e);
					
					l1.Point2.y += function(e) {
						switch(e.keyCode) {
							case 87: 
								return -1;
							case 83:
								return 1;
						}
						return 0;
					}(e);
				};
				
				lineSegs.push(l1);
				lineSegs.push(l2);
				*/
			};
		
			var Update = function(viewModel) {
				console.log(lineSegs[0].IsIntersecting(lineSegs[1]));
			};
			
			var Render = function(viewModel) {
				viewModel.context.strokeStyle = "#fff";
				viewModel.context.lineWidth = 1;
				
				for(var i = 0; i < lineSegs.length; i++) {
					viewModel.context.beginPath();
					viewModel.context.moveTo(lineSegs[i].Point1.x, lineSegs[i].Point1.y);
					viewModel.context.lineTo(lineSegs[i].Point2.x, lineSegs[i].Point2.y);
					viewModel.context.stroke();
					viewModel.context.closePath();
				}
			};
		
			new GameViewModel({
				CanvasId: 'scene', 
				Fps: 5, 
				InitialiseCallback: Initialise, 
				UpdateCallback: Update, 
				RenderCallback: Render
			}).Begin();
		</script>
	</body>
</html>